{% extends 'base.html' %}
{% load static %}

{% block title %}Search Results - Kouekam Digital Hub{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 mt-20">
    <div class="max-w-4xl mx-auto">
        <!-- Search Form -->
        <div class="mb-8">
            <form method="get" action="{% url 'search' %}" class="flex gap-2">
                <input 
                    type="text" 
                    name="q" 
                    value="{{ query }}" 
                    placeholder="Search blog posts, projects, notes..."
                    class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                >
                <button 
                    type="submit"
                    class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500"
                >
                    <i class="fas fa-search mr-2"></i>Search
                </button>
            </form>
        </div>

        {% if query %}
            <div class="mb-6">
                <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
                    Search Results for "{{ query }}"
                </h1>
                <p class="text-gray-600 dark:text-gray-400">
                    Found {{ total_results }} result{{ total_results|pluralize }}
                </p>
            </div>

            <!-- Blog Posts Results -->
            {% if results.blog_posts %}
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">
                    <i class="fas fa-blog mr-2"></i>Blog Posts ({{ results.blog_posts|length }})
                </h2>
                <div class="space-y-4">
                    {% for post in results.blog_posts %}
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 hover:shadow-lg transition-shadow">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
                            <a href="{% url 'blog_detail' post.slug %}" class="hover:text-blue-600 dark:hover:text-blue-400">
                                {{ post.title }}
                            </a>
                        </h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm mb-2">
                            {{ post.content|truncatewords:30|striptags }}
                        </p>
                        <div class="flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400">
                            <span><i class="fas fa-calendar mr-1"></i>{{ post.published_date|date:"M d, Y"|default:post.created_at|date:"M d, Y" }}</span>
                            <span><i class="fas fa-tag mr-1"></i>{{ post.get_category_display }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Projects Results -->
            {% if results.projects %}
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">
                    <i class="fas fa-project-diagram mr-2"></i>Projects ({{ results.projects|length }})
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {% for project in results.projects %}
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 hover:shadow-lg transition-shadow">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
                            <a href="{% url 'project_detail' project.slug %}" class="hover:text-blue-600 dark:hover:text-blue-400">
                                {{ project.title }}
                            </a>
                        </h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm mb-3">
                            {{ project.description|truncatewords:20 }}
                        </p>
                        <div class="flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400">
                            <span><i class="fas fa-tag mr-1"></i>{{ project.get_category_display }}</span>
                            <span><i class="fas fa-circle text-{{ project.status }} mr-1"></i>{{ project.get_status_display }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Notes Results (only for authenticated users) -->
            {% if request.user.is_authenticated and results.notes %}
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">
                    <i class="fas fa-sticky-note mr-2"></i>Notes ({{ results.notes|length }})
                </h2>
                <div class="space-y-4">
                    {% for note in results.notes %}
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 hover:shadow-lg transition-shadow">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
                            <a href="{% url 'course_detail' note.course.id %}" class="hover:text-blue-600 dark:hover:text-blue-400">
                                {{ note.title }}
                            </a>
                        </h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm mb-2">
                            {{ note.content|truncatewords:30|striptags }}
                        </p>
                        <div class="flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400">
                            <span><i class="fas fa-book mr-1"></i>{{ note.course.name }}</span>
                            <span><i class="fas fa-calendar mr-1"></i>{{ note.updated_at|date:"M d, Y" }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- No Results -->
            {% if total_results == 0 %}
            <div class="text-center py-12">
                <i class="fas fa-search text-6xl text-gray-300 dark:text-gray-600 mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No results found</h3>
                <p class="text-gray-600 dark:text-gray-400">
                    Try different keywords or check your spelling.
                </p>
            </div>
            {% endif %}
        {% else %}
            <div class="text-center py-12">
                <i class="fas fa-search text-6xl text-gray-300 dark:text-gray-600 mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Search</h3>
                <p class="text-gray-600 dark:text-gray-400">
                    Enter a search query to find blog posts, projects, and notes.
                </p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

