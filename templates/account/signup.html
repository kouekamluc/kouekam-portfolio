{% extends "account/base.html" %}
{% load i18n %}

{% block head_title %}{% trans "Sign Up" %}{% endblock %}

{% block content %}
<div class="w-full max-w-md mx-auto card">
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
            Create Account
        </h1>
        <p class="text-gray-600 dark:text-gray-400">
            Join Kouekam Digital Hub today
        </p>
    </div>

    <form method="POST" action="{% url 'account_signup' %}" class="space-y-6">
        {% csrf_token %}
        
        {% if form.non_field_errors %}
            <div class="p-4 mb-4 text-sm text-red-800 bg-red-50 dark:bg-red-900 dark:text-red-200 rounded-lg border border-red-200 dark:border-red-800" role="alert">
                {{ form.non_field_errors }}
            </div>
        {% endif %}

        <div>
            <label for="{{ form.email.id_for_label }}" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                Email <span class="text-red-500 dark:text-red-400">*</span>
            </label>
            <input 
                type="email" 
                name="{{ form.email.name }}"
                id="{{ form.email.id_for_label }}"
                {% if form.email.value %}value="{{ form.email.value }}"{% endif %}
                class="input-field dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 {% if form.email.errors %}border-red-500 dark:border-red-500{% endif %}"
                placeholder="name@example.com"
                required
                autocomplete="email"
            >
            {% if form.email.errors %}
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.email.errors }}</p>
            {% endif %}
        </div>

        <div>
            <label for="{{ form.password1.id_for_label }}" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                Password <span class="text-red-500 dark:text-red-400">*</span>
            </label>
            <input 
                type="password" 
                name="{{ form.password1.name }}"
                id="{{ form.password1.id_for_label }}"
                class="input-field dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 {% if form.password1.errors %}border-red-500 dark:border-red-500{% endif %}"
                placeholder="••••••••"
                required
                autocomplete="new-password"
                oninput="validatePassword(this.value)"
            >
            {% if form.password1.errors %}
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.password1.errors }}</p>
            {% endif %}
            <div id="password-requirements" class="mt-2 space-y-1.5 hidden">
                <p class="text-xs font-medium text-gray-700 dark:text-gray-300 mb-2">Password requirements:</p>
                <div class="space-y-1">
                    <div id="req-length" class="flex items-center text-xs">
                        <span class="requirement-icon mr-2">○</span>
                        <span class="text-gray-600 dark:text-gray-400">At least 8 characters</span>
                    </div>
                    <div id="req-uppercase" class="flex items-center text-xs">
                        <span class="requirement-icon mr-2">○</span>
                        <span class="text-gray-600 dark:text-gray-400">Contains uppercase letter</span>
                    </div>
                    <div id="req-lowercase" class="flex items-center text-xs">
                        <span class="requirement-icon mr-2">○</span>
                        <span class="text-gray-600 dark:text-gray-400">Contains lowercase letter</span>
                    </div>
                    <div id="req-number" class="flex items-center text-xs">
                        <span class="requirement-icon mr-2">○</span>
                        <span class="text-gray-600 dark:text-gray-400">Contains number</span>
                    </div>
                    <div id="req-special" class="flex items-center text-xs">
                        <span class="requirement-icon mr-2">○</span>
                        <span class="text-gray-600 dark:text-gray-400">Contains special character (!@#$%^&*)</span>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <label for="{{ form.password2.id_for_label }}" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                Password (again) <span class="text-red-500 dark:text-red-400">*</span>
            </label>
            <input 
                type="password" 
                name="{{ form.password2.name }}"
                id="{{ form.password2.id_for_label }}"
                class="input-field dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 {% if form.password2.errors %}border-red-500 dark:border-red-500{% endif %}"
                placeholder="••••••••"
                required
                autocomplete="new-password"
            >
            {% if form.password2.errors %}
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.password2.errors }}</p>
            {% endif %}
        </div>

        {% if redirect_field_value %}
            <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
        {% endif %}

        <button 
            type="submit" 
            class="btn-primary w-full"
        >
            Sign up
        </button>
    </form>

    <div class="mt-6 text-center">
        <p class="text-sm text-gray-600 dark:text-gray-400">
            Already have an account? 
            <a href="{% url 'account_login' %}" class="text-blue-600 dark:text-blue-400 hover:underline font-medium">
                Sign in
            </a>
        </p>
    </div>
</div>

<script>
function validatePassword(password) {
    const requirements = {
        length: password.length >= 8,
        uppercase: /[A-Z]/.test(password),
        lowercase: /[a-z]/.test(password),
        number: /[0-9]/.test(password),
        special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
    };

    // Show requirements div when user starts typing
    const requirementsDiv = document.getElementById('password-requirements');
    if (password.length > 0) {
        requirementsDiv.classList.remove('hidden');
    } else {
        requirementsDiv.classList.add('hidden');
        return;
    }

    // Update each requirement indicator
    updateRequirement('req-length', requirements.length);
    updateRequirement('req-uppercase', requirements.uppercase);
    updateRequirement('req-lowercase', requirements.lowercase);
    updateRequirement('req-number', requirements.number);
    updateRequirement('req-special', requirements.special);
}

function updateRequirement(id, isValid) {
    const element = document.getElementById(id);
    const icon = element.querySelector('.requirement-icon');
    const text = element.querySelector('span:last-child');
    
    if (isValid) {
        icon.textContent = '✓';
        icon.className = 'requirement-icon mr-2 text-green-600 dark:text-green-400';
        text.className = 'text-green-600 dark:text-green-400';
    } else {
        icon.textContent = '○';
        icon.className = 'requirement-icon mr-2 text-gray-400 dark:text-gray-500';
        text.className = 'text-gray-600 dark:text-gray-400';
    }
}

// Show requirements on focus
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('{{ form.password1.id_for_label }}');
    if (passwordInput) {
        passwordInput.addEventListener('focus', function() {
            if (this.value.length === 0) {
                document.getElementById('password-requirements').classList.remove('hidden');
            }
        });
    }
});
</script>
{% endblock %}







